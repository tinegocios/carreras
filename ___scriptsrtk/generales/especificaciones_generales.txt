
## üìÑ Documento de Objetivos ‚Äì Integraci√≥n de GPS Real al Simulador de Carreras

### 1. Contexto general

Actualmente el simulador de carreras georreferenciadas cuenta con un componente que **emula dispositivos GPS** mediante un script que env√≠a coordenadas de posici√≥n (latitud y longitud) al servidor WebSocket.
Este mecanismo ha permitido probar el flujo completo del sistema (simulaci√≥n, visualizaci√≥n en mapa, y actualizaci√≥n de posiciones en tiempo real) sin depender de un hardware real.

En esta nueva etapa del proyecto, el objetivo es **sustituir la fuente de datos simulada** por una **fuente de datos proveniente de un GPS f√≠sico o real**, adaptando la forma en que el servidor interpreta y procesa las coordenadas entrantes.

---

### 2. Necesidad identificada

Durante la revisi√≥n de los dispositivos GPS disponibles, se observ√≥ que los equipos reales **no env√≠an las coordenadas en formato simple (latitud/longitud)**, sino que utilizan **mensajes NMEA**, particularmente las tramas **GPGGA o GPRMC**, que son los formatos est√°ndar de salida de m√≥dulos como los U-Blox.
Por lo tanto, el servidor actual no puede interpretar directamente estas cadenas y requiere una capa de **traducci√≥n o decodificaci√≥n**.

---

### 3. Objetivo principal

**Permitir que el servidor del simulador reciba y procese directamente las tramas GPS reales (NMEA), interpretando sus coordenadas y transform√°ndolas al formato interno utilizado por el sistema.**

Esto implica que el flujo de entrada se ajuste a las caracter√≠sticas de un GPS f√≠sico, conservando la misma estructura de salida hacia el cliente (mapa, leaderboard, gr√°ficas).

---

### 4. Objetivos espec√≠ficos

1. **Identificar y revisar el script actual de simulaci√≥n GPS**
   Localizar el script existente que genera las coordenadas simuladas (ubicado en `tools/gps-sim.js`) y documentar su estructura de datos actual (ID, lat, lon, timestamp). Este servir√° como referencia para definir la nueva capa de entrada.

2. **Analizar el formato NMEA recibido por el GPS real**
   Determinar el tipo exacto de trama utilizada (GPGGA, GPRMC, etc.), los campos relevantes (latitud, longitud, hora, altitud, n√∫mero de sat√©lites, etc.) y la manera en que se reciben (por socket, puerto serial, o TCP).

3. **Dise√±ar un m√≥dulo de conversi√≥n**
   Crear un componente intermedio que **interprete las tramas NMEA** y **genere mensajes equivalentes** a los que el servidor espera actualmente (es decir, `{id, lat, lon, ts}`), sin alterar el resto de la infraestructura.

4. **Probar la integraci√≥n con un dispositivo GPS real**
   Conectar un dispositivo f√≠sico (por ejemplo, m√≥dulo U-Blox o receptor USB) y validar la conversi√≥n en tiempo real, asegurando que los corredores se muestren correctamente en el mapa.

5. **Mantener compatibilidad con el modo simulado**
   Conservar el funcionamiento del modo de simulaci√≥n para pruebas controladas, permitiendo alternar entre fuente ‚Äúsimulada‚Äù y fuente ‚Äúreal‚Äù desde la configuraci√≥n del sistema.

---

### 5. Resultados esperados

* El servidor podr√° recibir datos tanto de un **GPS f√≠sico** como del **script simulador**, indistintamente.
* Las posiciones de los corredores se visualizar√°n correctamente en el mapa y en las gr√°ficas de velocidad.
* El sistema quedar√° preparado para **carreras con dispositivos GPS reales** transmitiendo sus posiciones en vivo.
* Se documentar√° el proceso de conversi√≥n desde NMEA hacia latitud/longitud, como parte del nuevo flujo de entrada.

---

### 6. Alcance

Este trabajo no implica cambios en la interfaz de usuario ni en la l√≥gica de visualizaci√≥n del simulador.
El enfoque est√° centrado en el **flujo de datos de entrada**, asegurando la correcta **integraci√≥n, interpretaci√≥n y compatibilidad** entre fuentes simuladas y reales.
